name: Security Audit

on:
    schedule:
        # Run daily at 6:00 AM UTC
        - cron: "0 6 * * *"
    push:
        branches:
            - main
        paths:
            - "backend/Cargo.toml"
            - "backend/Cargo.lock"
    pull_request:
        branches:
            - main
        paths:
            - "backend/Cargo.toml"
            - "backend/Cargo.lock"

jobs:
    audit:
        name: Security audit
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Run cargo audit
              uses: rustsec/audit-check@v2.0.0
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}
                  working-directory: backend
                  # Ignore RUSTSEC-2025-0134: rustls-pemfile unmaintained warning
                  # This is a dev-dependency via testcontainers->bollard
                  # Waiting for bollard to migrate to rustls-pki-types
                  ignore: RUSTSEC-2025-0134
